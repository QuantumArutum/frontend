# API ç¼“å­˜å®ç°æ–‡æ¡£

**å®æ–½æ—¥æœŸ**: 2026-01-18  
**çŠ¶æ€**: âœ… å·²å®Œæˆï¼ˆåŸºç¡€ç‰ˆæœ¬ï¼‰  
**ä»»åŠ¡**: ä»»åŠ¡3.1 - é›†æˆç¼“å­˜æœºåˆ¶ï¼ˆç®€åŒ–ç‰ˆï¼‰

---

## ğŸ“‹ æ¦‚è¿°

å®ç°äº†ä¸€ä¸ªç®€å•çš„å†…å­˜ç¼“å­˜æœºåˆ¶ï¼Œç”¨äºç¼“å­˜APIå“åº”ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢ï¼Œæå‡APIå“åº”é€Ÿåº¦ã€‚

**æ³¨æ„**: è¿™æ˜¯ä¸€ä¸ªåŸºäºå†…å­˜çš„ç¼“å­˜å®ç°ï¼Œé€‚ç”¨äºå•å®ä¾‹éƒ¨ç½²ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå»ºè®®å‡çº§åˆ°Redisç­‰åˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿã€‚

---

## ğŸ› ï¸ å®ç°ç»†èŠ‚

### 1. ç¼“å­˜å·¥å…·ç±»

**æ–‡ä»¶**: `src/lib/cache.ts`

**åŠŸèƒ½**:

- å†…å­˜ç¼“å­˜å­˜å‚¨
- TTLï¼ˆç”Ÿå­˜æ—¶é—´ï¼‰æ”¯æŒ
- è‡ªåŠ¨è¿‡æœŸæ¸…ç†
- ç¼“å­˜å¤§å°é™åˆ¶ï¼ˆé»˜è®¤200æ¡ï¼‰
- ç¼“å­˜è£…é¥°å™¨å‡½æ•°

**æ ¸å¿ƒAPI**:

```typescript
// è·å–ç¼“å­˜
cache.get<T>(key: string): T | null

// è®¾ç½®ç¼“å­˜
cache.set<T>(key: string, data: T, ttl: number): void

// åˆ é™¤ç¼“å­˜
cache.delete(key: string): void

// æ¸…ç©ºç¼“å­˜
cache.clear(): void

// ç¼“å­˜è£…é¥°å™¨
withCache<T>(key: string, ttl: number, fetchFn: () => Promise<T>): Promise<T>

// ç”Ÿæˆç¼“å­˜é”®
generateCacheKey(prefix: string, params: Record<string, any>): string
```

**ç¼“å­˜æ—¶é—´å¸¸é‡**:

```typescript
CacheTTL.ONE_MINUTE; // 1åˆ†é’Ÿ
CacheTTL.TWO_MINUTES; // 2åˆ†é’Ÿ
CacheTTL.FIVE_MINUTES; // 5åˆ†é’Ÿ
CacheTTL.TEN_MINUTES; // 10åˆ†é’Ÿ
CacheTTL.THIRTY_MINUTES; // 30åˆ†é’Ÿ
CacheTTL.ONE_HOUR; // 1å°æ—¶
```

### 2. å·²åº”ç”¨ç¼“å­˜çš„API

#### 2.1 è®ºå›åˆ†ç±»API

**æ–‡ä»¶**: `src/app/api/v2/barong/public/community/forum-categories/route.ts`

**ç¼“å­˜ç­–ç•¥**:

- ç¼“å­˜é”®: `forum-categories:all`
- TTL: 5åˆ†é’Ÿ
- åŸå› : åˆ†ç±»æ•°æ®å˜åŒ–ä¸é¢‘ç¹

**é¢„æœŸæ•ˆæœ**:

- é¦–æ¬¡è¯·æ±‚: æŸ¥è¯¢æ•°æ®åº“ï¼ˆ~300-500msï¼‰
- ç¼“å­˜å‘½ä¸­: ç›´æ¥è¿”å›ï¼ˆ<10msï¼‰
- æ€§èƒ½æå‡: 95%+

#### 2.2 çƒ­é—¨å¸–å­API

**æ–‡ä»¶**: `src/app/api/v2/barong/public/community/hot-posts/route.ts`

**ç¼“å­˜ç­–ç•¥**:

- ç¼“å­˜é”®: `hot-posts:{page}:{limit}:{timeRange}`
- TTL: 2åˆ†é’Ÿ
- åŸå› : çƒ­é—¨å¸–å­éœ€è¦ç›¸å¯¹å®æ—¶çš„æ•°æ®

**é¢„æœŸæ•ˆæœ**:

- é¦–æ¬¡è¯·æ±‚: æŸ¥è¯¢æ•°æ®åº“ï¼ˆ~500-800msï¼‰
- ç¼“å­˜å‘½ä¸­: ç›´æ¥è¿”å›ï¼ˆ<10msï¼‰
- æ€§èƒ½æå‡: 95%+

#### 2.3 æ ‡ç­¾åˆ—è¡¨API

**æ–‡ä»¶**: `src/app/api/v2/barong/public/community/tags/route.ts`

**ç¼“å­˜ç­–ç•¥**:

- ç¼“å­˜é”®: `tags:{page}:{limit}:{search}:{sortBy}`
- TTL: 5åˆ†é’Ÿ
- åŸå› : æ ‡ç­¾æ•°æ®å˜åŒ–ä¸é¢‘ç¹

**é¢„æœŸæ•ˆæœ**:

- é¦–æ¬¡è¯·æ±‚: æŸ¥è¯¢æ•°æ®åº“ï¼ˆ~300-500msï¼‰
- ç¼“å­˜å‘½ä¸­: ç›´æ¥è¿”å›ï¼ˆ<10msï¼‰
- æ€§èƒ½æå‡: 95%+

#### 2.4 æœç´¢API

**æ–‡ä»¶**: `src/app/api/v2/barong/public/community/search/route.ts`

**ç¼“å­˜ç­–ç•¥**:

- ç¼“å­˜é”®: `search:{query}:{type}:{limit}:{offset}`
- TTL: 5åˆ†é’Ÿ
- åŸå› : ç›¸åŒæœç´¢æŸ¥è¯¢ç»“æœå¯ä»¥ç¼“å­˜

**é¢„æœŸæ•ˆæœ**:

- é¦–æ¬¡è¯·æ±‚: æŸ¥è¯¢æ•°æ®åº“ï¼ˆ~800-1200msï¼‰
- ç¼“å­˜å‘½ä¸­: ç›´æ¥è¿”å›ï¼ˆ<10msï¼‰
- æ€§èƒ½æå‡: 95%+

---

## ğŸ“Š æ€§èƒ½å½±å“

### é¢„æœŸæ€§èƒ½æå‡

| API      | æ— ç¼“å­˜å“åº”æ—¶é—´ | ç¼“å­˜å‘½ä¸­å“åº”æ—¶é—´ | æå‡å¹…åº¦ |
| -------- | -------------- | ---------------- | -------- |
| è®ºå›åˆ†ç±» | 300-500ms      | <10ms            | 95%+     |
| çƒ­é—¨å¸–å­ | 500-800ms      | <10ms            | 95%+     |
| æ ‡ç­¾åˆ—è¡¨ | 300-500ms      | <10ms            | 95%+     |
| æœç´¢     | 800-1200ms     | <10ms            | 95%+     |

### æ•°æ®åº“è´Ÿè½½å‡å°‘

- è®ºå›åˆ†ç±»: æ¯5åˆ†é’Ÿæœ€å¤š1æ¬¡æŸ¥è¯¢ï¼ˆvs æ¯æ¬¡è¯·æ±‚ï¼‰
- çƒ­é—¨å¸–å­: æ¯2åˆ†é’Ÿæœ€å¤š1æ¬¡æŸ¥è¯¢ï¼ˆvs æ¯æ¬¡è¯·æ±‚ï¼‰
- æ ‡ç­¾åˆ—è¡¨: æ¯5åˆ†é’Ÿæœ€å¤š1æ¬¡æŸ¥è¯¢ï¼ˆvs æ¯æ¬¡è¯·æ±‚ï¼‰
- æœç´¢: æ¯5åˆ†é’Ÿæœ€å¤š1æ¬¡æŸ¥è¯¢ï¼ˆvs æ¯æ¬¡è¯·æ±‚ï¼‰
- é¢„è®¡æ•°æ®åº“æŸ¥è¯¢å‡å°‘: 85-95%

### ç”¨æˆ·ä½“éªŒæå‡

- é¡µé¢åŠ è½½é€Ÿåº¦æ˜¾è‘—æå‡
- æœåŠ¡å™¨å“åº”æ›´å¿«
- å¯æ”¯æŒæ›´é«˜å¹¶å‘

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### åŸºç¡€ç”¨æ³•

```typescript
import { withCache, CacheTTL } from '@/lib/cache';

export async function GET() {
  const data = await withCache('my-cache-key', CacheTTL.FIVE_MINUTES, async () => {
    // æ•°æ®è·å–é€»è¾‘
    return await fetchDataFromDatabase();
  });

  return NextResponse.json({ data });
}
```

### å¸¦å‚æ•°çš„ç¼“å­˜

```typescript
import { withCache, generateCacheKey, CacheTTL } from '@/lib/cache';

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const page = searchParams.get('page') || '1';
  const limit = searchParams.get('limit') || '20';

  const cacheKey = generateCacheKey('my-api', { page, limit });

  const data = await withCache(cacheKey, CacheTTL.TWO_MINUTES, async () => {
    return await fetchDataFromDatabase(page, limit);
  });

  return NextResponse.json({ data });
}
```

### æ‰‹åŠ¨ç¼“å­˜ç®¡ç†

```typescript
import cache from '@/lib/cache';

// è·å–ç¼“å­˜
const data = cache.get<MyType>('my-key');

// è®¾ç½®ç¼“å­˜
cache.set('my-key', data, 5 * 60 * 1000); // 5åˆ†é’Ÿ

// åˆ é™¤ç¼“å­˜
cache.delete('my-key');

// æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
cache.clear();
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. å†…å­˜é™åˆ¶

- å½“å‰å®ç°åŸºäºå†…å­˜ï¼Œç¼“å­˜æ•°æ®å­˜å‚¨åœ¨åº”ç”¨è¿›ç¨‹ä¸­
- é»˜è®¤æœ€å¤§ç¼“å­˜æ¡ç›®: 200ä¸ª
- è¶…è¿‡é™åˆ¶æ—¶ï¼Œè‡ªåŠ¨åˆ é™¤æœ€æ—§çš„æ¡ç›®

### 2. å•å®ä¾‹é™åˆ¶

- ç¼“å­˜ä¸è·¨å®ä¾‹å…±äº«
- åœ¨å¤šå®ä¾‹éƒ¨ç½²æ—¶ï¼Œæ¯ä¸ªå®ä¾‹æœ‰ç‹¬ç«‹çš„ç¼“å­˜
- å¯èƒ½å¯¼è‡´ç¼“å­˜ä¸ä¸€è‡´

### 3. æ•°æ®ä¸€è‡´æ€§

- ç¼“å­˜æ•°æ®å¯èƒ½ä¸æ•°æ®åº“ä¸åŒæ­¥
- æ•°æ®æ›´æ–°åï¼Œç¼“å­˜ä¸ä¼šè‡ªåŠ¨å¤±æ•ˆ
- éœ€è¦æ‰‹åŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜æˆ–ç­‰å¾…TTLè¿‡æœŸ

### 4. å†…å­˜ä½¿ç”¨

- ç¼“å­˜ä¼šå ç”¨åº”ç”¨å†…å­˜
- éœ€è¦ç›‘æ§å†…å­˜ä½¿ç”¨æƒ…å†µ
- é¿å…ç¼“å­˜è¿‡å¤§çš„æ•°æ®å¯¹è±¡

---

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

### çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

1. **æ‰©å±•ç¼“å­˜è¦†ç›–**
   - æ ‡ç­¾åˆ—è¡¨API
   - ç”¨æˆ·èµ„æ–™API
   - æœç´¢ç»“æœAPI

2. **ç¼“å­˜å¤±æ•ˆæœºåˆ¶**
   - æ•°æ®æ›´æ–°æ—¶ä¸»åŠ¨æ¸…é™¤ç›¸å…³ç¼“å­˜
   - å®ç°ç¼“å­˜æ ‡ç­¾ï¼ˆtagï¼‰ç³»ç»Ÿ

3. **ç›‘æ§å’Œç»Ÿè®¡**
   - ç¼“å­˜å‘½ä¸­ç‡ç»Ÿè®¡
   - ç¼“å­˜å¤§å°ç›‘æ§
   - æ€§èƒ½æŒ‡æ ‡æ”¶é›†

### ä¸­æœŸï¼ˆ1ä¸ªæœˆï¼‰

1. **å‡çº§åˆ°Redis**
   - æ³¨å†ŒUpstash Redisè´¦å·
   - è¿ç§»åˆ°åˆ†å¸ƒå¼ç¼“å­˜
   - æ”¯æŒå¤šå®ä¾‹éƒ¨ç½²

2. **é«˜çº§ç¼“å­˜ç­–ç•¥**
   - ç¼“å­˜é¢„çƒ­
   - ç¼“å­˜ç©¿é€ä¿æŠ¤
   - ç¼“å­˜é›ªå´©é˜²æŠ¤

3. **ç¼“å­˜åˆ†å±‚**
   - L1: å†…å­˜ç¼“å­˜ï¼ˆå¿«é€Ÿè®¿é—®ï¼‰
   - L2: Redisç¼“å­˜ï¼ˆæŒä¹…åŒ–ï¼‰

### é•¿æœŸï¼ˆ3ä¸ªæœˆï¼‰

1. **æ™ºèƒ½ç¼“å­˜**
   - åŸºäºè®¿é—®é¢‘ç‡çš„åŠ¨æ€TTL
   - è‡ªåŠ¨è¯†åˆ«çƒ­ç‚¹æ•°æ®
   - é¢„æµ‹æ€§ç¼“å­˜é¢„åŠ è½½

2. **ç¼“å­˜åˆ†æ**
   - ç¼“å­˜æ•ˆç‡åˆ†æ
   - æˆæœ¬æ•ˆç›Šåˆ†æ
   - ä¼˜åŒ–å»ºè®®

---

## ğŸ“ˆ ç›‘æ§æŒ‡æ ‡

### å…³é”®æŒ‡æ ‡

1. **ç¼“å­˜å‘½ä¸­ç‡**
   - ç›®æ ‡: >80%
   - è®¡ç®—: å‘½ä¸­æ¬¡æ•° / æ€»è¯·æ±‚æ¬¡æ•°

2. **å¹³å‡å“åº”æ—¶é—´**
   - ç¼“å­˜å‘½ä¸­: <10ms
   - ç¼“å­˜æœªå‘½ä¸­: <500ms

3. **ç¼“å­˜å¤§å°**
   - å½“å‰æ¡ç›®æ•°
   - å†…å­˜ä½¿ç”¨é‡

4. **è¿‡æœŸæ¸…ç†**
   - æ¸…ç†é¢‘ç‡
   - æ¸…ç†æ¡ç›®æ•°

### ç›‘æ§æ–¹æ³•

```typescript
// è·å–ç¼“å­˜ç»Ÿè®¡
const stats = {
  size: cache.size(),
  // å¯ä»¥æ·»åŠ æ›´å¤šç»Ÿè®¡ä¿¡æ¯
};
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- `src/lib/cache.ts` - ç¼“å­˜å·¥å…·ç±»
- `src/app/api/v2/barong/public/community/forum-categories/route.ts` - è®ºå›åˆ†ç±»API
- `src/app/api/v2/barong/public/community/hot-posts/route.ts` - çƒ­é—¨å¸–å­API
- `CRITICAL_FIXES_ROADMAP.md` - ä»»åŠ¡è·¯çº¿å›¾

---

## ğŸ“ é—®é¢˜å’Œåé¦ˆ

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‚è€ƒï¼š

- ä»»åŠ¡3.1: é›†æˆRedisç¼“å­˜ï¼ˆå®Œæ•´ç‰ˆï¼‰
- Next.jsç¼“å­˜æ–‡æ¡£: https://nextjs.org/docs/app/building-your-application/caching

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2026-01-18  
**ç»´æŠ¤è€…**: Kiro AI Assistant
