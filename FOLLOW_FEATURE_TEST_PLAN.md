# 关注功能测试计划

## 📅 测试日期

2026-01-17

## 🎯 测试目标

验证关注/取消关注功能的完整流程

---

## 📋 测试准备

### 测试账号

1. **账号 A**: `aurum51668@outlook.com` / `TestPass2026!`
2. **账号 B**: `1317874966@qq.com` / `QQTest2026!`

### 测试环境

- **生产环境**: https://www.quantaureum.com
- **数据库**: Neon PostgreSQL (serverless)

---

## 🧪 测试用例

### 测试 1: 查看自己的资料页

**操作步骤**:

1. 使用账号 A 登录
2. 访问 `/community/user/aurum51668`

**预期结果**:

- ✅ 显示用户信息
- ✅ 显示统计数据（帖子、获赞、关注者、关注中）
- ✅ **不显示**关注按钮
- ✅ 显示"编辑资料"按钮
- ✅ 关注者和关注中数字可点击

---

### 测试 2: 查看其他用户的资料页

**操作步骤**:

1. 使用账号 A 登录
2. 访问账号 B 的资料页（需要先获取 B 的用户名）

**预期结果**:

- ✅ 显示用户信息
- ✅ 显示统计数据
- ✅ 显示"关注"按钮
- ✅ 显示"发送消息"按钮
- ✅ **不显示**"编辑资料"按钮

---

### 测试 3: 关注用户

**操作步骤**:

1. 使用账号 A 登录
2. 访问账号 B 的资料页
3. 点击"关注"按钮

**预期结果**:

- ✅ 按钮文字变为"取消关注"
- ✅ 按钮样式变化（从渐变色变为灰色）
- ✅ 账号 B 的关注者数量 +1
- ✅ 数据库中创建关注记录

**验证 API**:

```bash
# 检查关注状态
GET /api/v2/barong/public/community/is-following?userId={B的ID}
# 应返回: { "success": true, "data": { "isFollowing": true } }

# 检查 B 的关注者列表
GET /api/v2/barong/public/community/followers?userId={B的ID}
# 应包含账号 A

# 检查 A 的关注中列表
GET /api/v2/barong/public/community/following?userId={A的ID}
# 应包含账号 B
```

---

### 测试 4: 取消关注

**操作步骤**:

1. 在测试 3 的基础上
2. 点击"取消关注"按钮

**预期结果**:

- ✅ 按钮文字变为"关注"
- ✅ 按钮样式恢复（渐变色）
- ✅ 账号 B 的关注者数量 -1
- ✅ 数据库中删除关注记录

**验证 API**:

```bash
# 检查关注状态
GET /api/v2/barong/public/community/is-following?userId={B的ID}
# 应返回: { "success": true, "data": { "isFollowing": false } }
```

---

### 测试 5: 关注者列表弹窗

**操作步骤**:

1. 使用账号 A 关注账号 B
2. 访问账号 B 的资料页
3. 点击"关注者"数字

**预期结果**:

- ✅ 显示关注者列表弹窗
- ✅ 列表中包含账号 A
- ✅ 显示用户头像、用户名、帖子数
- ✅ 点击用户可跳转到其资料页
- ✅ 点击关闭按钮或背景可关闭弹窗

---

### 测试 6: 关注中列表弹窗

**操作步骤**:

1. 使用账号 A 关注账号 B
2. 访问账号 A 的资料页
3. 点击"关注中"数字

**预期结果**:

- ✅ 显示关注中列表弹窗
- ✅ 列表中包含账号 B
- ✅ 显示用户头像、用户名、帖子数
- ✅ 点击用户可跳转到其资料页
- ✅ 点击关闭按钮或背景可关闭弹窗

---

### 测试 7: 未登录用户查看资料页

**操作步骤**:

1. 退出登录
2. 访问任意用户的资料页

**预期结果**:

- ✅ 显示用户信息和统计数据
- ✅ **不显示**关注按钮
- ✅ **不显示**发送消息按钮
- ✅ **不显示**编辑资料按钮
- ✅ 可以查看关注者和关注中列表

---

### 测试 8: 重复关注

**操作步骤**:

1. 使用账号 A 关注账号 B
2. 尝试再次关注账号 B（通过 API）

**预期结果**:

- ✅ API 返回错误："Already following this user"
- ✅ 前端按钮状态正确（显示"取消关注"）

---

### 测试 9: 关注自己

**操作步骤**:

1. 尝试通过 API 关注自己

**预期结果**:

- ✅ API 返回错误："Cannot follow yourself"
- ✅ 前端不显示关注按钮（查看自己的资料时）

---

### 测试 10: 数据库表自动创建

**操作步骤**:

1. 删除 `user_follows` 表（如果存在）
2. 访问任意用户资料页

**预期结果**:

- ✅ 表自动创建
- ✅ 页面正常显示
- ✅ 关注功能正常工作

---

## 🔍 API 测试

### 1. 关注用户 API

```bash
POST /api/v2/barong/public/community/follow
Content-Type: application/json

{
  "userId": "user_xxx"
}
```

**预期响应**:

```json
{
  "success": true,
  "message": "Successfully followed user"
}
```

### 2. 取消关注 API

```bash
DELETE /api/v2/barong/public/community/follow?userId=user_xxx
```

**预期响应**:

```json
{
  "success": true,
  "message": "Successfully unfollowed user"
}
```

### 3. 检查关注状态 API

```bash
GET /api/v2/barong/public/community/is-following?userId=user_xxx
```

**预期响应**:

```json
{
  "success": true,
  "data": {
    "isFollowing": true
  }
}
```

### 4. 关注者列表 API

```bash
GET /api/v2/barong/public/community/followers?userId=user_xxx&limit=20&offset=0
```

**预期响应**:

```json
{
  "success": true,
  "data": {
    "followers": [
      {
        "id": "user_yyy",
        "username": "testuser",
        "email": "test@example.com",
        "avatar": "T",
        "postCount": 5,
        "followedAt": "2026-01-17T...",
        "joinedAt": "2026-01-16T..."
      }
    ],
    "pagination": {
      "total": 1,
      "limit": 20,
      "offset": 0,
      "hasMore": false
    }
  }
}
```

### 5. 关注中列表 API

```bash
GET /api/v2/barong/public/community/following?userId=user_xxx&limit=20&offset=0
```

**预期响应**: 同上

---

## 📊 性能测试

### 1. API 响应时间

- 关注/取消关注: < 500ms
- 获取关注列表: < 1000ms
- 检查关注状态: < 300ms

### 2. 并发测试

- 10 个用户同时关注同一用户
- 验证数据一致性

---

## 🐛 边界情况测试

### 1. 大量关注者

- 创建 100+ 关注关系
- 测试列表加载性能
- 测试分页功能

### 2. 网络错误

- 模拟网络中断
- 验证错误提示
- 验证重试机制

### 3. 权限测试

- 未登录用户尝试关注
- 验证 401 错误返回

---

## ✅ 测试检查清单

### 功能测试

- [ ] 查看自己的资料页
- [ ] 查看其他用户的资料页
- [ ] 关注用户
- [ ] 取消关注
- [ ] 关注者列表弹窗
- [ ] 关注中列表弹窗
- [ ] 未登录用户查看资料页
- [ ] 重复关注保护
- [ ] 关注自己保护

### API 测试

- [ ] 关注 API
- [ ] 取消关注 API
- [ ] 检查关注状态 API
- [ ] 关注者列表 API
- [ ] 关注中列表 API

### UI/UX 测试

- [ ] 按钮状态正确
- [ ] 加载状态显示
- [ ] 错误提示友好
- [ ] 弹窗交互流畅
- [ ] 响应式设计

### 性能测试

- [ ] API 响应时间
- [ ] 页面加载速度
- [ ] 大量数据处理

### 安全测试

- [ ] 认证检查
- [ ] 权限验证
- [ ] SQL 注入防护
- [ ] XSS 防护

---

## 📝 测试记录

### 测试执行记录

| 测试用例 | 状态 | 执行时间 | 备注   |
| -------- | ---- | -------- | ------ |
| 测试 1   | ⏳   | -        | 待执行 |
| 测试 2   | ⏳   | -        | 待执行 |
| 测试 3   | ⏳   | -        | 待执行 |
| 测试 4   | ⏳   | -        | 待执行 |
| 测试 5   | ⏳   | -        | 待执行 |
| 测试 6   | ⏳   | -        | 待执行 |
| 测试 7   | ⏳   | -        | 待执行 |
| 测试 8   | ⏳   | -        | 待执行 |
| 测试 9   | ⏳   | -        | 待执行 |
| 测试 10  | ⏳   | -        | 待执行 |

---

## 🔧 问题追踪

### 发现的问题

| 问题ID | 描述 | 严重程度 | 状态 | 解决方案 |
| ------ | ---- | -------- | ---- | -------- |
| -      | -    | -        | -    | -        |

---

## 📈 测试总结

### 测试覆盖率

- 功能测试: 0/10 (0%)
- API 测试: 0/5 (0%)
- UI/UX 测试: 0/5 (0%)
- 性能测试: 0/2 (0%)
- 安全测试: 0/4 (0%)

**总体覆盖率**: 0/26 (0%)

### 下一步行动

1. 等待 Vercel 部署完成
2. 执行所有测试用例
3. 记录测试结果
4. 修复发现的问题
5. 重新测试

---

**测试计划创建时间**: 2026-01-17
**测试负责人**: Kiro AI
**状态**: 待执行
