# Phase 9-11 完整测试计划

## 🎯 目标：100% 测试覆盖

---

## 第一步：配置版主权限

### 1.1 运行数据库迁移

访问以下 URL 创建版主系统表：
```
https://frontend-git-main-quantumarutums-projects.vercel.app/api/v2/barong/public/community/migrate-moderator-system
```

方法：POST

预期结果：
```json
{
  "success": true,
  "message": "Moderator system migration completed successfully",
  "details": {
    "tables_created": ["moderators", "mod_actions", "user_bans"],
    "tables_updated": ["posts", "post_reports"],
    "indexes_created": 11
  }
}
```

### 1.2 添加版主权限

方法 1：通过 API 添加（需要已有管理员）
```bash
POST /api/v2/barong/public/community/mod/moderators
{
  "userId": "aurum51668@outlook.com",
  "role": "admin",
  "currentUserId": "system_admin"
}
```

方法 2：直接在数据库中添加（推荐）
```sql
INSERT INTO moderators (user_id, role, appointed_by, appointed_at)
VALUES ('aurum51668@outlook.com', 'admin', 'system', NOW());
```

---

## 第二步：Phase 9 完整测试（目标：100%）

### 2.1 已测试功能 ✅
- [x] Markdown 编辑器基本功能
- [x] 创建帖子流程
- [x] 草稿保存
- [x] 帖子管理按钮显示

### 2.2 待测试功能 ⏳

#### 2.2.1 图片上传完整流程
1. 访问创建帖子页面
2. 点击"上传图片"按钮
3. 选择图片文件（JPEG/PNG/GIF/WebP）
4. 验证上传成功
5. 验证图片 Markdown 自动插入
6. 发布帖子
7. 验证图片在帖子中正确显示

**测试用例**：
- [ ] 上传 JPEG 图片
- [ ] 上传 PNG 图片
- [ ] 上传 GIF 图片
- [ ] 上传 WebP 图片
- [ ] 上传超过 5MB 的图片（应失败）
- [ ] 上传非图片文件（应失败）

#### 2.2.2 草稿恢复
1. 创建帖子但不发布
2. 点击"保存草稿"
3. 关闭页面
4. 重新打开创建帖子页面
5. 验证草稿自动恢复

**测试用例**：
- [ ] 草稿保存成功
- [ ] 草稿恢复成功
- [ ] 发布后草稿清除

#### 2.2.3 编辑帖子
1. 打开自己的帖子
2. 点击"编辑"按钮
3. 修改标题和内容
4. 保存修改
5. 验证修改成功

**测试用例**：
- [ ] 编辑按钮显示（仅作者可见）
- [ ] 编辑页面加载
- [ ] 原内容正确显示
- [ ] 修改保存成功
- [ ] 编辑历史记录

#### 2.2.4 删除帖子
1. 打开自己的帖子
2. 点击"删除"按钮
3. 确认删除
4. 验证帖子已删除

**测试用例**：
- [ ] 删除按钮显示（仅作者可见）
- [ ] 删除确认对话框
- [ ] 删除成功
- [ ] 重定向到社区首页

---

## 第三步：Phase 10 完整测试（目标：100%）

### 3.1 已测试功能 ✅
- [x] 发表评论
- [x] 嵌套回复
- [x] @提及显示
- [x] 展开/折叠回复
- [x] 评论排序按钮显示

### 3.2 待测试功能 ⏳

#### 3.2.1 评论点赞
1. 打开有评论的帖子
2. 点击评论的"点赞"按钮
3. 验证点赞数增加
4. 再次点击取消点赞
5. 验证点赞数减少

**测试用例**：
- [ ] 点赞成功
- [ ] 点赞数更新
- [ ] 取消点赞成功
- [ ] 点赞状态保持
- [ ] 点赞通知发送

#### 3.2.2 评论编辑
1. 找到自己的评论
2. 点击"编辑"按钮
3. 修改评论内容
4. 保存修改
5. 验证修改成功

**测试用例**：
- [ ] 编辑按钮显示（仅作者可见）
- [ ] 编辑模式切换
- [ ] 原内容显示
- [ ] 修改保存成功
- [ ] 显示"已编辑"标记

#### 3.2.3 评论删除
1. 找到自己的评论
2. 点击"删除"按钮
3. 确认删除
4. 验证评论已删除

**测试用例**：
- [ ] 删除按钮显示（仅作者可见）
- [ ] 删除确认对话框
- [ ] 删除成功
- [ ] 评论数更新

#### 3.2.4 评论排序
1. 打开有多条评论的帖子
2. 点击"最新"排序
3. 验证评论按时间倒序排列
4. 点击"最热"排序
5. 验证评论按点赞数排列
6. 点击"最佳"排序
7. 验证评论按综合评分排列
8. 点击"最早"排序
9. 验证评论按时间正序排列

**测试用例**：
- [ ] 最新排序正确
- [ ] 最热排序正确
- [ ] 最佳排序正确
- [ ] 最早排序正确
- [ ] 排序状态保持

#### 3.2.5 @提及自动补全
1. 在评论框输入 @
2. 验证用户列表弹出
3. 选择用户
4. 验证用户名自动插入

**测试用例**：
- [ ] @ 触发用户列表
- [ ] 用户搜索功能
- [ ] 用户选择插入
- [ ] @提及通知发送

---

## 第四步：Phase 11 完整测试（目标：100%）

### 4.1 前置条件
- [x] 数据库迁移完成
- [ ] 版主权限配置完成

### 4.2 版主功能测试

#### 4.2.1 置顶帖子
1. 以版主身份打开帖子
2. 点击"置顶"按钮
3. 选择置顶类型（全局/分类）
4. 验证帖子已置顶
5. 验证置顶标记显示

**测试用例**：
- [ ] 置顶按钮显示（仅版主可见）
- [ ] 全局置顶成功
- [ ] 分类置顶成功
- [ ] 置顶标记显示
- [ ] 取消置顶成功

**API**: `POST /api/v2/barong/public/community/mod/pin-post`

#### 4.2.2 锁定帖子
1. 以版主身份打开帖子
2. 点击"锁定"按钮
3. 输入锁定原因
4. 验证帖子已锁定
5. 验证无法评论

**测试用例**：
- [ ] 锁定按钮显示（仅版主可见）
- [ ] 锁定成功
- [ ] 锁定标记显示
- [ ] 禁止评论
- [ ] 解锁成功

**API**: `POST /api/v2/barong/public/community/mod/lock-post`

#### 4.2.3 移动帖子
1. 以版主身份打开帖子
2. 点击"移动"按钮
3. 选择目标分类
4. 验证帖子已移动

**测试用例**：
- [ ] 移动按钮显示（仅版主可见）
- [ ] 分类列表显示
- [ ] 移动成功
- [ ] 分类更新

**API**: `POST /api/v2/barong/public/community/mod/move-post`

#### 4.2.4 删除评论（版主）
1. 以版主身份打开帖子
2. 找到任意评论
3. 点击"删除"按钮（版主权限）
4. 输入删除原因
5. 验证评论已删除

**测试用例**：
- [ ] 删除按钮显示（版主可见所有评论）
- [ ] 删除原因输入
- [ ] 删除成功
- [ ] 删除记录保存

**API**: `DELETE /api/v2/barong/public/community/mod/delete-comment`

#### 4.2.5 禁言用户
1. 以版主身份访问用户资料
2. 点击"禁言"按钮
3. 选择禁言时长
4. 输入禁言原因
5. 验证用户已被禁言

**测试用例**：
- [ ] 禁言按钮显示（仅版主可见）
- [ ] 时长选择（1天/7天/30天/永久）
- [ ] 禁言成功
- [ ] 用户无法发帖/评论
- [ ] 解除禁言成功

**API**: `POST /api/v2/barong/public/community/mod/mute-user`

#### 4.2.6 封禁用户
1. 以版主身份访问用户资料
2. 点击"封禁"按钮
3. 选择封禁时长
4. 输入封禁原因
5. 验证用户已被封禁

**测试用例**：
- [ ] 封禁按钮显示（仅管理员可见）
- [ ] 时长选择
- [ ] 封禁成功
- [ ] 用户无法登录
- [ ] 解除封禁成功

**API**: `POST /api/v2/barong/public/community/mod/ban-user`

#### 4.2.7 版主管理
1. 以管理员身份访问版主管理页面
2. 查看版主列表
3. 添加新版主
4. 修改版主权限
5. 移除版主

**测试用例**：
- [ ] 版主列表显示
- [ ] 添加版主成功
- [ ] 权限修改成功
- [ ] 移除版主成功
- [ ] 通知发送

**API**: `GET/POST/PUT/DELETE /api/v2/barong/public/community/mod/moderators`

#### 4.2.8 版主日志
1. 以版主身份访问日志页面
2. 查看所有版主操作记录
3. 筛选操作类型
4. 搜索特定版主
5. 导出日志

**测试用例**：
- [ ] 日志列表显示
- [ ] 操作类型筛选
- [ ] 版主筛选
- [ ] 时间范围筛选
- [ ] 日志详情查看

**API**: `GET /api/v2/barong/public/community/mod/logs`

---

## 第五步：集成测试

### 5.1 完整用户流程
1. 注册新用户
2. 创建帖子（含图片）
3. 发表评论
4. 回复评论
5. 点赞评论
6. 编辑帖子
7. 删除评论

### 5.2 版主工作流程
1. 版主登录
2. 查看待审核内容
3. 置顶优质帖子
4. 锁定违规帖子
5. 删除违规评论
6. 禁言违规用户
7. 查看操作日志

### 5.3 性能测试
- [ ] 页面加载时间 < 2秒
- [ ] API 响应时间 < 500ms
- [ ] 图片上传时间 < 3秒
- [ ] 评论加载时间 < 1秒

### 5.4 安全测试
- [ ] XSS 防护
- [ ] CSRF 防护
- [ ] SQL 注入防护
- [ ] 权限验证
- [ ] 文件上传安全

---

## 测试进度追踪

### Phase 9: 发帖功能
- 已测试: 4/8 (50%)
- 待测试: 4/8 (50%)
- 目标: 8/8 (100%)

### Phase 10: 评论系统
- 已测试: 4/9 (44%)
- 待测试: 5/9 (56%)
- 目标: 9/9 (100%)

### Phase 11: 版主系统
- 已测试: 0/8 (0%)
- 待测试: 8/8 (100%)
- 目标: 8/8 (100%)

### 总体进度
- 已测试: 8/25 (32%)
- 待测试: 17/25 (68%)
- 目标: 25/25 (100%)

---

## 测试环境

- **生产环境**: https://frontend-git-main-quantumarutums-projects.vercel.app
- **测试账号**: aurum51668@outlook.com / TestPass2026!
- **版主账号**: 待配置
- **数据库**: 需要配置

---

## 预期完成时间

- 配置版主权限: 10分钟
- Phase 9 完整测试: 30分钟
- Phase 10 完整测试: 30分钟
- Phase 11 完整测试: 45分钟
- 集成测试: 30分钟
- **总计**: 约 2.5 小时

---

## 测试报告

测试完成后将生成：
1. `PHASE9_100_PERCENT_TEST_REPORT.md`
2. `PHASE10_100_PERCENT_TEST_REPORT.md`
3. `PHASE11_100_PERCENT_TEST_REPORT.md`
4. `FINAL_COMPREHENSIVE_TEST_REPORT.md`

